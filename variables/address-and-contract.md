# Address ä¸ Contract


## Address

ä» solidity 5.0 ç‰ˆæœ¬å¼€å§‹ï¼Œåœ°å€æœ‰ä¸¤ç§ç±»å‹ï¼Œ`address` ä¸ `address payable`ã€‚ ä¸¤è€…çš„åŒºåˆ«ä¸ºï¼š`address payable` å¯æ”¯ä»˜åœ°å€ï¼Œå…·æœ‰ä¸¤ä¸ªæ”¯ä»˜ç›¸å…³`transfer` å’Œ `send` æˆå‘˜å‡½æ•°ï¼›è€Œ `address` æ²¡æœ‰è¿™ä¸ªè¦æ±‚ï¼Œæ—¢å¯ä»¥æœ‰ä¹Ÿå¯ä»¥æ²¡æœ‰æ”¯ä»˜åŠŸèƒ½ã€‚

ä¸¤è€…çš„å…³ç³»ç±»ä¼¼`address`æ˜¯`address payable`çš„çˆ¶ç±»ï¼Œå› æ­¤ä¸¤è€…äº’ç›¸è½¬æ¢çš„è§„åˆ™æ˜¯ï¼š

- address -> address payableï¼Œæ˜¾å¼è½¬æ¢ã€‚è¦æ±‚è¯¥ address å¿…é¡»æœ‰ `receive` å‡½æ•°æˆ–è€…æœ‰ payable çš„å›é€€å‡½æ•°ï¼›
- address payable -> addressï¼Œéšå¼è½¬æ¢ã€‚

> åœ¨ solidity 5.0 ä¹‹å‰ï¼Œaddress ä¸ address payable çš„è½¬åŒ–éœ€è¦é€šè¿‡ä¸­é—´å˜é‡è£…æ¢ï¼Œä¾‹å¦‚
>
> ```
> payable(int160(<address>))
> ```

### è¿ç®—ç¬¦

å› ä¸ºåœ°å€æœ¬è´¨ä¸Šå°±æ˜¯`int160`ï¼Œå› æ­¤æ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ ` <`ã€`<=`ã€`==`ã€`!=`ã€`\>=`ã€`\>`ã€‚åœ°å€è¿›è¡ŒåŠ å‡ä¹˜æ•°è¿ç®—åº”è¯¥æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤åœ°å€ä¸æ”¯æŒè®¡ç®—è¿ç®—ç¬¦ã€‚

### æˆå‘˜å‡½æ•°

####  balance 

`balance`å‡½æ•°ç”¨äºæŸ¥è¯¢åœ°å€ Ether ä½™é¢ã€‚

```js
<Address>.balance()
```

#### transfer 

`transfer` å‡½æ•°ç”¨äºå‘è¯¥åœ°å€è½¬è´¦ã€‚

```js
<Address>.transfer(<uint>)
```

å¦‚æœè¿™é‡Œçš„`Adress`æ˜¯åˆçº¦åœ°å€ï¼Œé‚£ä¹ˆè¯¥åˆçº¦çš„`receive`å‡½æ•°ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨åˆ™`payable`ä¿®é¥°çš„å›é€€å‡½æ•°ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœ`payable`ä¿®é¥°çš„å›é€€å‡½æ•°ä¹Ÿä¸å­˜åœ¨ï¼Œåˆ™æ­¤æ¬¡è½¬è´¦å°±ä¼šå¤±è´¥ã€‚å¦‚æœè½¬è´¦å¤±è´¥ä¼šè®© transfer æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ²¡æœ‰è¢«å¤„ç†ï¼Œå°†ä¼šè§¦å‘æ•´ä¸ªåˆçº¦å›æ»šã€‚

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‘æŸä¸€ä¸ªåˆçº¦åœ°å€è½¬è´¦ï¼Œæœ‰å¯èƒ½ä¼šä»¥æœ¬åˆçº¦ä¸ºå‘èµ·è€…ï¼ˆsenderï¼‰ï¼Œè°ƒç”¨å’Œæ‰§è¡Œè¯¥åˆçº¦çš„åœ¨receiveå‡½æ•°æˆ–å›é€€å‡½æ•°ä¸­å®šä¹‰çš„ä»£ç ï¼Œä½†è¿™äº›ä»£ç åˆæ˜¯å‘èµ·åˆçº¦ä¸å¯æ§çš„ï¼Œè¿™ç§æœºåˆ¶å¯èƒ½ä¼šå­˜åœ¨ä¸€äº›é£é™©ã€‚

å¥½åœ¨ EVM ä¸º transfer å‡½æ•°è®¾ç½®äº†å®‰å…¨æªæ–½ï¼Œå³æˆ‘ä»¬åœ¨ä½¿ç”¨ transfer å‡½æ•°çš„æ—¶å€™ï¼ŒEVM ä»…ä¼šç»™ transfer å‡½æ•°è§¦å‘çš„å¤–éƒ¨è°ƒç”¨åˆ†é… 2300 gasï¼Œè¿™ç‚¹ gas å¹¶ä¸è¶³ä»¥æ”¯æ’‘ç›®æ ‡åˆçº¦æ‰§è¡Œå…¶ä»–å¤æ‚çš„ä»£ç ã€‚

#### send

send å‡½æ•°æ˜¯ transfer å‡½æ•°çš„ä½çº§ç‰ˆæœ¬ï¼Œæ„å‘³ç€å…¶æ²¡æœ‰ transfer è¯¸å¤šé«˜çº§ç‰¹æ€§ã€‚ä¸¤è€…çš„åŒºåˆ«æ˜¯

- send è°ƒç”¨å¦‚æœå¤±è´¥ï¼Œä¸ä¼šè§¦å‘å¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªä»£è¡¨æˆåŠŸä¸å¦çš„å¸ƒå°”å€¼ï¼›
- send è°ƒç”¨æ²¡æœ‰ç‰¹æ„çš„ gas é™åˆ¶ï¼›

#### call

call å‡½æ•°æ˜¯ä½çº§å‡½æ•°ï¼Œæä¾›äº†ç›´æ¥æ§åˆ¶ç¼–ç ä¸å…¶ä»–åˆçº¦è¿›è¡Œäº¤äº’çš„èƒ½åŠ›ã€‚æ›´åº•å±‚æ„å‘³ç€æ›´åŠ å±é™©ï¼Œéœ€è¦æ›´åŠ å°å¿ƒä½¿ç”¨ã€‚

call å‡½æ•°æ¥æ”¶ä¸€ä¸ª `bytes memory` å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªä»£è¡¨æˆåŠŸä¸å¦çš„`bool`å€¼å’ŒåŒ…å«å…·ä½“æ•°æ®çš„`bytes memory`å€¼ã€‚

`bytes memory` çš„å‚æ•°ä¸è¿”å›å€¼éƒ½å¯ä»¥ä½¿ç”¨[`abi`åŒ…å†…](../abi.md)çš„å‡½æ•°è¿›è¡Œå¤„ç†ã€‚ 

```JS
address nameReg = 0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2;
bytes memory payload = abi.encodeWithSignature("register(string)", "MyName");
(bool success, bytes memory returnData) = address(nameReg).call(payload);
require(success);
```

#### delegatecall

delegatecall çš„ä½¿ç”¨æ–¹å¼ä¸callä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äº delegatecall ä»…ä½¿ç”¨è¢«è°ƒç”¨åˆçº¦çš„ç›¸åº”å‡½æ•°ä»£ç ï¼Œä½†å‡½æ•°æ‰§è¡Œçš„ç¯å¢ƒè¿˜æ˜¯å½“å‰çš„åˆçº¦ã€‚

delegatecall è¢«è®¾è®¡ç”¨æ¥å®ç°ç±»åº“ä»£ç çš„åŠŸèƒ½ã€‚å³ä»£ç å‚¨å­˜åœ¨ä¸€ä¸ªåˆçº¦åœ°å€ä¸Šï¼Œå…¶ä»–ä»£ç å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°è·å–è¿™äº›å‡½æ•°ä»£ç åœ¨æœ¬åˆçº¦ä¸­æ‰§è¡Œã€‚

#### staticcall

ä½¿ç”¨æ–¹å¼ä¸ call å‡½æ•°ä¸€è‡´ï¼Œä¸è¿‡åœ¨ä½¿ç”¨ staticcall å‡½æ•°çš„æ—¶å€™ï¼Œéœ€è¦å¼€å‘è€…æ˜ç¡®çŸ¥é“è°ƒç”¨çš„å‡½æ•°ä¸ä¼šä¿®æ”¹ä»»ä½•å‚¨å­˜åœ¨åŒºå—é“¾ä¸Šçš„çŠ¶æ€ã€‚

> âš ï¸ è­¦å‘Š
>
> callã€delegatecallã€staticcall éƒ½æ˜¯éå¸¸ä½çº§çš„å‡½æ•°ï¼Œå› æ­¤ä½¿ç”¨éœ€è¦éå¸¸å°å¿ƒã€‚ä»»ä½•ä½ ä½¿ç”¨è¿™äº›å‡½æ•°è°ƒç”¨çš„å…¶ä»–åˆçº¦å‡½æ•°éƒ½å¯èƒ½æ˜¯æ¶æ„çš„ï¼Œæœ‰å¯èƒ½ä¼šé‡æ–°å›è°ƒä½ å½“å‰åˆçº¦ä¸­çš„å‡½æ•°ã€‚è¿™é‡Œçš„é£é™©å¯ä»¥è€ƒè™‘ "**é‡å…¥**"ã€‚

### ä¿®æ”¹å™¨

ä¿®æ”¹å™¨å¯ä»¥ä¿®é¥°ä¸Šè¿°çš„ callã€delegatecallã€staticcallå‡½æ•°ï¼Œè®¾ç½®è°ƒç”¨æ—¶çš„ gas æ•°é‡å’Œè½¬è´¦çš„ ether æ•°é‡ã€‚

```js
bytes memory payload = abi.encodeWithSignature("register(string)", "MyName");
address(nameReg).call{gas:1000000, value: 1 ether}(payload);
```

å…¶ä¸­ delegatecall ä¸æ”¯æŒæœ‰ value ä¿®é¥°ã€‚ä¸ºä»€ä¹ˆä¸èƒ½æœ‰ value ä¿®é¥°çš„åŸå› åº”è¯¥æ˜¯å‡ºäºä¿æŠ¤è°ƒç”¨è€…èµ„äº§çš„è€ƒè™‘ã€‚

### ç±»å‹è½¬åŒ–

Address å¯ä»¥ä¸ä»¥ä¸‹ç±»äº’ç›¸è½¬åŒ–ï¼š
1. `address` <-> `address payable`

   - address payable è½¬ address ä¸ºéšå¼è½¬åŒ–ï¼›

   - address è½¬ address payable ä¸ºæ˜¾å¼è½¬åŒ–ï¼Œç”¨æ³•ä¸º `payable(<address>)`ï¼›
   
     ğŸ¤” **å¾…ç¡®è®¤ï¼šaddress è½¬ä¸º address payable ä¼¼ä¹æ²¡æœ‰è¦æ±‚è¿™ä¸ªåœ°å€å¯¹åº”çš„åˆçº¦ä¸€å®šè¦å¯è½¬è´¦ï¼Œä½†æ˜¯ Contract ç±»å‹è½¬ä¸º address payable æœ‰è¦æ±‚ã€‚**
     
   - ç‰¹ä¾‹ï¼špayable(0) æ˜¯å…è®¸çš„ï¼›
   
     
   
2. `address` <-> `uint160`

3. `address` <-> `bytes20`

4. `address` <-> `Contract`

## Contract

åœ¨ Solidity 0.5.0 ç‰ˆæœ¬ä¹‹å‰ï¼ŒContract æ˜¯ Address çš„å­ç±»ï¼Œä½†è‡ªè¯¥ç‰ˆæœ¬å Contract ä¸å†æ˜¯ Address çš„å­ç±»ã€‚

### ç±»å‹è½¬æ¢

1. å­åˆçº¦è½¬çˆ¶åˆçº¦ä¸ºéšå¼è½¬åŒ–ï¼›

2. Address Contract äº’è½¬

   ä¸¤è€…äº’è½¬å‡ä¸ºæ˜¾å¼è½¬åŒ–ï¼›

3. Contract ä¸ address payable äº’è½¬

   ä¸¤è€…äº’è½¬å‡ä¸ºæ˜¾ç¤ºè½¬åŒ–ã€‚

   - å½“è¯¥åˆçº¦å®ç°äº†è½¬è´¦åŠŸèƒ½ï¼Œ  address payable è½¬ Contract ç±»å‹ä½¿ç”¨çš„æ˜¯ address(x) å‡½æ•°ã€‚

   - å½“è¯¥åˆçº¦æœªå®ç°è½¬è´¦åŠŸèƒ½ï¼Œå¯ä»¥å€Ÿé“ address ç±»å‹æ›²çº¿æ•‘å›½ï¼Œå³ `payable(address(x))`

     ğŸ¤” ä½†æ˜¯æ²¡æ˜ç™½è¿™ä¹ˆåšçš„æ„ä¹‰ï¼Ÿ

### ç±»çš„åˆ›å»º

#### æ˜¾å¼è½¬æ¢èµ‹å€¼

è¯¥ç§æ–¹å¼é€‚ç”¨äºå¦ä¸€ä¸ªåˆçº¦å·²ç»éƒ¨ç½²ï¼Œå¯ä»¥åœ¨æœ¬åˆçº¦ä¸­æ ¹æ®åˆçº¦åœ°å€åˆ›å»ºå‡ºæ¥ã€‚

```js
ContractA contractA = Contract(<address>);
```

ğŸ¤” è¿™ç§æ–¹å¼æ–‡æ¡£ä¸­æè¿°ä¸æ¸…æ™°

#### new åˆ›å»º

è¯¥ç§æ–¹å¼é€‚ç”¨äºè¦åˆ›å»ºçš„åˆçº¦ä»£ç æ˜¯è‡ªå·±å†™çš„æˆ–è€…è·å–åˆ°äº†åˆçº¦ä»£ç çš„æƒ…å†µï¼Œå¯ä»¥åœ¨æœ¬åˆçº¦ä¸­å¼•å…¥åé€šè¿‡ new å…³é”®è¯åˆ›å»ºå‡ºæ¥ã€‚

```JS
// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.7.0 <0.9.0;
contract D {
    uint public x;
    constructor(uint a) payable {
        x = a;
    }
}

contract C {
    D d = new D(4); 
}
```

æ›´å¤šé€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¦ä¸€ä¸ªåˆçº¦å¯¹è±¡çš„çŸ¥è¯†å¯ä»¥é˜…è¯»æ–‡æ¡£ [Create Contract](https://docs.soliditylang.org/en/latest/control-structures.html#creating-contracts)ã€‚

### è¿ç®—ç¬¦

åˆçº¦ä¸æ”¯æŒä»»ä½•è¿ç®—ç¬¦ã€‚

### æˆå‘˜å˜é‡ä¸æˆå‘˜å‡½æ•°

åˆçº¦ç±»å‹çš„æˆå‘˜æ˜¯åˆçº¦çš„å¤–éƒ¨å‡½æ•°åŠ public çš„ çŠ¶æ€å˜é‡ã€‚

