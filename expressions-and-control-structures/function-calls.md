# å‡½æ•°è°ƒç”¨

#### å†…éƒ¨å‡½æ•°è°ƒç”¨ Internal Function Calls

å½“å‰åˆçº¦çš„å‡½æ•°å¯ä»¥ç›´æŽ¥è¢«è°ƒç”¨ï¼ˆinternallyï¼‰ï¼Œä¹Ÿå¯ä»¥é€’å½’è°ƒç”¨ã€‚åˆçº¦å†…çš„å‡½æ•°è°ƒç”¨è¢« EVM ç¼–è¯‘æˆäº†ä»£ç è·³è½¬ï¼Œæ­¤æ—¶å†…å­˜ä¸­çš„æ•°æ®å¹¶ä¸ä¼šè¢«æ¸…é™¤ï¼Œå› æ­¤åœ¨å†…éƒ¨è°ƒç”¨çš„å‡½æ•°ä¹‹é—´ä¼ é€’å†…å­˜å¼•ç”¨éžå¸¸é«˜æ•ˆã€‚**ä»…åŒä¸€ä¸ªåˆçº¦çš„å‡½æ•°å¯ä»¥è¢«å†…éƒ¨è°ƒç”¨ã€‚**

é€’å½’è°ƒç”¨å¹¶ä¸èƒ½æ— é™é€’å½’ã€‚æ¯ä¸€æ¬¡å‡½æ•°å†…éƒ¨è°ƒç”¨æ¶ˆè€—ä¸€ä¸ªå †æ ˆæ§½ï¼Œæ€»å…± 1024 ä¸ªå †æ ˆæ§½ã€‚

#### å¤–éƒ¨å‡½æ•°è°ƒç”¨

è¡¨è¾¾å¼ä¾‹å¦‚`this.g(8)` å’Œ `c.g(2)`ï¼Œå…¶ä¸­ c æ˜¯åˆçº¦å®žä¾‹ã€‚è¿™ç§å¤–éƒ¨è°ƒç”¨ä½¿ç”¨è¿‡ä¸€ç§æ¶ˆæ¯è°ƒç”¨çš„æœºåˆ¶è¿›è¡Œï¼Œå¹¶ä¸æ˜¯ä»£ç è·³è½¬ã€‚ä»Žä¸€ä¸ªåˆçº¦åˆ°å¦ä¸€ä¸ªåˆçº¦çš„æ¶ˆæ¯è°ƒç”¨å¹¶ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ transactionï¼Œè€Œæ˜¯æ•´ä¸ª transaction çš„ä¸€éƒ¨åˆ†ã€‚

**`this.g()`è¿™ç§è°ƒç”¨ä¸èƒ½ç”¨äºŽæž„é€ å‡½æ•°ï¼Œå› ä¸ºæ­¤æ—¶è¯¥åˆçº¦è¿˜æœªè¢«åˆ›å»ºã€‚**

å¦‚æžœè¦è°ƒç”¨å…¶ä»–åˆçº¦çš„å‡½æ•°ï¼Œå°±éœ€è¦å¤–éƒ¨è°ƒç”¨ã€‚å¯¹äºŽä¸€ä¸ªå¤–éƒ¨è°ƒç”¨ï¼Œæ‰€æœ‰çš„å‡½æ•°å‚æ•°éƒ½ä¼šè¢«å¤åˆ¶è¿›å†…å­˜ã€‚

å½“è°ƒç”¨å…¶ä»–åˆçº¦çš„å‡½æ•°çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨**ä¿®æ”¹å™¨**ä¿®æ”¹å‘é€çš„ Wei æˆ–è€…å‘é€çš„ gasã€‚**ä½†æ˜¯ä¸å»ºè®®æ˜Žç¡®æŒ‡å®š gasï¼Œå› ä¸ºå„ä¸ªæ“ä½œç ä½¿ç”¨çš„ gas æ¶ˆè€—å¯èƒ½ä¼šåœ¨æœªæ¥å‘ç”Ÿæ”¹å˜ã€‚** å‘é€ç»™åˆçº¦çš„ Wei ä¼šåŠ åˆ°åˆçº¦çš„ä½™é¢ä¸­ã€‚

```js
// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.6.2 <0.9.0;

contract InfoFeed {
    function info() public payable returns (uint ret) { return 42; }
}

contract Consuymer {
    InfoFeed feed;
    function setFeed(InfoFeed addr) public { feed = addr; }
    function callFeed() public { feed.info{ value:10, gas: 800 }(); }
  	// è¿™é‡Œçš„ feed.info{ value:10, gas: 800 } å¹¶æ²¡æœ‰æ‰§è¡Œè¯¥å‡½æ•°ï¼Œè€Œæ˜¯æœ€åŽçš„æ‹¬å·æ‰§è¡Œäº†è¯¥å‡½æ•°ã€‚
}
```

å› ä¸º EVM è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„åˆçº¦çš„æ–¹æ³•ä¹Ÿä¼šæˆåŠŸï¼Œå› æ­¤ Solidity æä¾›äº† `extcodesize`æ“ä½œç æ¥æ£€æŸ¥è°ƒç”¨çš„åˆçº¦æ˜¯å¦æ•´çš„å­˜åœ¨ï¼ˆæ˜¯å¦å­˜åœ¨ä»£ç ï¼‰ã€‚å¦‚æžœä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æžœè¿”å›žçš„æ•°æ®ä¼šè¢«è§£ç ï¼Œé‚£ä¹ˆè¯¥æ£€æŸ¥å°±ä¼šè¢«è·³è¿‡å¥½è®© ABI è§£æžå™¨æ•èŽ·åˆ°åˆçº¦ä¸å­˜åœ¨çš„é”™è¯¯ã€‚

ä½Žçº§åˆ«çš„ call è°ƒç”¨ä¸ä¼šæ‰§è¡Œ `extcodesize`æ£€æŸ¥ã€‚

>Be careful when using high-level calls to [precompiled contracts](https://docs.soliditylang.org/en/latest/introduction-to-smart-contracts.html#precompiledcontracts), since the compiler considers them non-existing according to the above logic even though they execute code and can return data.
>
>ðŸ¤” å•¥æ˜¯ precompiled contractsï¼Ÿ

ä¸Žå…¶ä»–åˆçº¦åšçš„ä»»ä½•äº¤äº’éƒ½å­˜åœ¨æ½œåœ¨çš„é£Žé™©ï¼Œç‰¹åˆ«æ˜¯åˆçº¦çš„æºç ä½ æ˜¯ä¸çŸ¥é“çš„ã€‚è°ƒç”¨å¯¹æ–¹å‡½æ•°å°±æ˜¯å°†æŽ§åˆ¶æƒç§»äº¤ç»™è¢«è°ƒç”¨åˆçº¦ï¼Œè€Œè¢«è°ƒç”¨åˆçº¦å¯ä»¥åšä»»ä½•äº‹ã€‚å³ä½¿è°ƒç”¨çš„å‡½æ•°æ˜¯ä»Žä¸€ä¸ªå·²çŸ¥çš„çˆ¶åˆçº¦ç»§æ‰¿è€Œæ¥ï¼Œç»§æ‰¿çš„åˆçº¦ä¹Ÿåªéœ€è¦å®žçŽ°ä¸€ä¸ªæ­£ç¡®çš„æŽ¥å£ï¼Œè€Œå…·ä½“çš„å®žçŽ°åˆ™æ˜¯å®Œå…¨ä»»æ„çš„ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œå°å¿ƒè°ƒç”¨çš„åˆçº¦é‡æ–°è°ƒç”¨ä½ æ‰€å†™ç³»ç»Ÿçš„å…¶ä»–åˆçº¦æˆ–å½“å‰çš„åˆçº¦ã€‚è¿™æ„å‘³ç€è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ï¼Œè€Œè¿™ä¸ªåˆçº¦æœ‰å¯èƒ½å›žè¿‡å¤´æ¥ä¿®æ”¹å‘èµ·è°ƒç”¨åˆçº¦çš„çŠ¶æ€ã€‚

å»ºè®®çš„å†™æ³•æ˜¯ï¼Œå…ˆå®Œæˆåˆçº¦ä¸­å„ç§å˜é‡çš„å˜æ›´ï¼Œç„¶åŽå†è¿›è¡Œå¤–éƒ¨å‡½æ•°è°ƒç”¨ã€‚è¿™æ ·ä½ çš„åˆçº¦ä¾¿ä¸ä¼šè¢«è½»æ˜“è¿›è¡Œ**é‡å…¥æ”»å‡»**ï¼ˆ**reentrancy**ï¼‰ã€‚

> åœ¨ Solidity 0.6.2 ä¹‹å‰ï¼ŒæŒ‡å®šä½™é¢å’Œ gas çš„æ–¹æ³•æ˜¯ä½¿ç”¨ f.value(x).gas(g)()ã€‚åœ¨ 0.6.2 ä¸­å·²ç»å¼ƒç”¨ï¼Œåœ¨ 0.7.0 ä¸­å·²ç§»é™¤ã€‚

#### å…·åè°ƒç”¨å’ŒåŒ¿åå‡½æ•°å‚æ•°

å‡½æ•°æ”¯æŒä¸¤ç§ä¼ å‚æ–¹å¼ï¼Œä¸€ç§æ˜¯å…·åï¼Œå³åœ¨ `{}` ä¸­å†™æ˜Žå‚æ•°åå’Œå‚æ•°å€¼ï¼Œé¡ºåºå¯ä»¥ä»»æ„ï¼›ä¸€ç§æ˜¯åŒ¿åï¼Œåªå†™å€¼ï¼Œä½†æ˜¯éœ€è¦ä¿è¯é¡ºåºä¸Žå£°æ˜Žæ—¶ä¸€è‡´ã€‚

#### çœç•¥å‡½æ•°å‚æ•°åç§°

æœªä½¿ç”¨çš„å‚æ•°çš„åç§°ï¼ˆç‰¹åˆ«æ˜¯è¿”å›žçš„å‚æ•°ï¼‰å¯ä»¥çœç•¥ã€‚è¿™äº›å‚æ•°ä»»ç„¶å­˜åœ¨äºŽå †æ ˆä¸­ï¼Œä½†æ˜¯æ— æ³•è®¿é—®ã€‚(ðŸ¤” æœ‰å•¥æ„ä¹‰ï¼Ÿ)

```JS
pragma solidity >=0.4.22 <0.9.0;

conntract C {
  function  func(uint k, uint) public pure returns(uint){
    return k;
  }
}
```



